<div class="container">
  <h1 class="text-center mt-5">Welcome {{ userName }}</h1>
  <div class="row justify-content-center">
    <div class="col-md-6">
      <form [formGroup]="requestForm" (ngSubmit)="onSubmit()" class="card p-4 mt-5 bounceInUp">
        <div *ngIf="showSuccessMessage" class="alert alert-success mt-3" role="alert">
          Request submitted successfully!
        </div>
        <h2 class="text-center mb-4">Request Snacks</h2>

        <div class="mb-3">
          <label for="type" class="form-label">Item Type:</label>
          <select class="form-select" id="type" formControlName="type">
            <option value="snack">Snack</option>
            <option value="drink">Drink</option>
            <option value="misc">Misc</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="item" class="form-label">Item Name:</label>
          <input type="text" class="form-control" id="item" formControlName="item" maxlength="150">
        </div>

        <div class="mb-3">  <label for="link" class="form-label">Link (optional, copy full URL):</label>
          <input type="text" class="form-control" id="link" formControlName="link">
        </div>

        <button type="submit" class="btn btn-danger" [disabled]="requestForm.get('item')?.invalid || submitting">
          <span *ngIf="submitting" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
          Submit Request
        </button>
    
        <div *ngIf="requestForm.get('item')?.invalid && requestForm.get('item')?.touched" class="alert alert-danger mt-3" role="alert">
          Item name is required.
        </div>

        <div *ngIf="submitError" class="alert alert-danger mt-3" role="alert">
          {{ submitError }}
        </div>
      </form>
    </div>
  </div>
</div>
<div *ngIf="userId" class="container mt-5 mb-5">
<div class="row justify-content-center">
  <div class="col-md-12">
    <h3 class="text-center mb-4">Your Snack Request History</h3>
    <div class="table-container"> 
    <!-- Desktop Table View -->
    <table class="table table-striped" *ngIf="userRequests.length > 0">
      <thead>
        <tr>
          <th>Status</th>
          <th>Snack</th>
          <th>Drink</th>
          <th>Misc</th>
          <th>Link</th>
          <th>Date Requested</th>
          <th>Date Ordered</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let request of userRequests" [class.ordered-row]="request.ordered_flag === 1">
          <td>
            <span *ngIf="request.ordered_flag === 1" class="badge bg-success" title="Your snack has been ordered!">
              ‚úì Ordered
            </span>
            <span *ngIf="request.ordered_flag === 0" class="badge bg-warning text-dark">
              ‚è≥ Pending
            </span>
          </td>
          <td>{{ request.snack }}</td>
          <td>{{ request.drink }}</td>
          <td>{{ request.misc }}</td>
          <td>
            <a *ngIf="request.link" href="{{ request.link }}" target="_blank" rel="noopener noreferrer">
              View Link
            </a>
            <span *ngIf="!request.link">N/A</span>
          </td>
          <td>{{ request.created_at | date: 'shortDate' }}</td>
          <td>
            <span *ngIf="request.ordered_at">
              {{ request.ordered_at | date: 'shortDate' }}
              <span class="text-success ms-1" *ngIf="request.ordered_flag === 1">üéâ</span>
            </span>
            <span *ngIf="!request.ordered_at" class="text-muted">‚Äî</span>
          </td>
        </tr>
        
      </tbody>
    </table>

    <!-- Mobile Card View -->
    <div class="mobile-card-view" *ngIf="userRequests.length > 0">
      <div *ngFor="let request of userRequests" 
           class="request-card" 
           [class.ordered]="request.ordered_flag === 1">
        <div class="card-header">
          <span class="card-title">Your Request</span>
          <span *ngIf="request.ordered_flag === 1" class="badge bg-success">
            ‚úì Ordered
          </span>
          <span *ngIf="request.ordered_flag === 0" class="badge bg-warning text-dark">
            ‚è≥ Pending
          </span>
        </div>
        <div class="card-row" *ngIf="request.snack">
          <span class="card-label">Snack:</span>
          <span class="card-value">{{ request.snack }}</span>
        </div>
        <div class="card-row" *ngIf="request.drink">
          <span class="card-label">Drink:</span>
          <span class="card-value">{{ request.drink }}</span>
        </div>
        <div class="card-row" *ngIf="request.misc">
          <span class="card-label">Misc:</span>
          <span class="card-value">{{ request.misc }}</span>
        </div>
        <div class="card-row" *ngIf="request.link">
          <span class="card-label">Link:</span>
          <span class="card-value">
            <a [href]="request.link" target="_blank" rel="noopener noreferrer">View Link</a>
          </span>
        </div>
        <div class="card-row">
          <span class="card-label">Requested:</span>
          <span class="card-value">{{ request.created_at | date: 'shortDate' }}</span>
        </div>
        <div class="card-row" *ngIf="request.ordered_at">
          <span class="card-label">Ordered:</span>
          <span class="card-value">
            {{ request.ordered_at | date: 'shortDate' }}
            <span *ngIf="request.ordered_flag === 1">üéâ</span>
          </span>
        </div>
      </div>
    </div>
    </div>
    <p class="text-center" *ngIf="userRequests.length === 0">You have not made any requests yet.</p>
  </div>
</div>
</div>
